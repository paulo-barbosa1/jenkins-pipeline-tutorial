pipeline {
    agent {
  label 'maven'
    }
    parameters {
        booleanParam(name: 'CLEAN_BEFORE_BUILD', description: 'limpa o ambiente depois do runnup')
    }
    stages {
        stage('Clean') {

            when {
                expression { params.CLEAN_BEFORE }
            }
            steps {
                sh 'mvn clean'
            }
    }
        stage('Compile') {
           steps {
              sh 'mvm compile'
            }
    }
        stage('Test') {
            steps {
               sh 'mvm verify'
               junit 'target/surefire-reports/*.xml'
            }
    }
        stage('Deploy') {
            steps {
                def pom = readMavenPom file: 'pom.xml'
                sh "./deploy.sh ${pom.getArtifactId()} ${pom.getVersion()}"
            }
        }
}

}